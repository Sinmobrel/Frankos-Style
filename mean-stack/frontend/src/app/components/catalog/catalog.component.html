<div class="catalog-container">
  <h1>Catálogo de Productos</h1>

  <!-- Filtros -->
  <div class="catalog-filters">
    <input 
      type="text" 
      [(ngModel)]="filterName" 
      (ngModelChange)="applyFilters()"
      placeholder="Buscar por nombre..." 
      class="filter-input" />

    <select 
      [(ngModel)]="filterCategory" 
      (ngModelChange)="applyFilters()"
      class="filter-select">
      <option value="">Todas las categorías</option>
      <option value="traje">Trajes</option>
      <option value="camisa">Camisas</option>
      <option value="corbata">Corbatas</option>
      <option value="accesorio">Accesorios</option>
    </select>

    <input 
      type="number" 
      [(ngModel)]="filterMinPrice" 
      (ngModelChange)="applyFilters()"
      placeholder="Precio mínimo" 
      class="filter-input" 
      min="0" />
      
    <input 
      type="number" 
      [(ngModel)]="filterMaxPrice" 
      (ngModelChange)="applyFilters()"
      placeholder="Precio máximo" 
      class="filter-input" 
      min="0" />
    
    <button class="btn-reset-filters" (click)="resetFilters()">Limpiar filtros</button>
  </div>

  <!-- Mensaje de resultados de filtros -->
  <div class="filter-results-message" *ngIf="!loading && products.length > 0 && products.length < allProducts.length">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    Se encontraron {{ products.length }} productos de {{ allProducts.length }} totales
  </div>

  <!-- Spinner de carga inicial (primera carga) -->
  <ng-container *ngIf="loading && allProducts.length === 0">
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando catálogo...</p>
    </div>
  </ng-container>

  <div class="error-message" *ngIf="error">{{ error }}</div>

  <div class="catalog-grid" *ngIf="!error && filteredProducts.length">
    <div class="catalog-card" *ngFor="let product of filteredProducts" (click)="openProductModal(product)">
      <img [src]="getProductImageUrl(product)" 
           [alt]="product.name" 
           class="catalog-img"
           (error)="onImageError($event)"
           loading="lazy" />
      <h2>{{ product.name }}</h2>
      <p class="catalog-category">{{ product.category }}</p>
      <p class="catalog-price">{{ product.price | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>
      <div class="catalog-view-more">Ver detalles</div>
    </div>
  </div>

  <!-- Controles de paginación -->
  <ng-container *ngIf="!loading && !error && totalProducts > 0">
    <div class="pagination-container">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalProducts) }} de {{ totalProducts }} productos
      </div>
      
      <div class="pagination-controls">
        <!-- Botón anterior -->
        <button 
          class="pagination-btn pagination-btn--prev" 
          [disabled]="currentPage === 1"
          (click)="previousPage()"
          aria-label="Página anterior">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
          Anterior
        </button>

        <!-- Números de página -->
        <div class="pagination-numbers">
          <button 
            *ngFor="let page of pageNumbers"
            [class.pagination-number]="page !== -1"
            [class.pagination-ellipsis]="page === -1"
            [class.active]="page === currentPage"
            [disabled]="page === -1 || page === currentPage"
            (click)="goToPage(page)"
            [attr.aria-label]="page === -1 ? null : 'Ir a página ' + page"
            [attr.aria-current]="page === currentPage ? 'page' : null">
            {{ page === -1 ? '...' : page }}
          </button>
        </div>

        <!-- Botón siguiente -->
        <button 
          class="pagination-btn pagination-btn--next" 
          [disabled]="currentPage === totalPages"
          (click)="nextPage()"
          aria-label="Página siguiente">
          Siguiente
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </div>
  </ng-container>

  <div class="empty-message" *ngIf="!loading && !error && products.length === 0 && allProducts.length > 0">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <p>No se encontraron productos con los filtros aplicados.</p>
    <button class="btn-reset-filters" (click)="resetFilters()">Limpiar filtros</button>
  </div>

  <div class="empty-message" *ngIf="!loading && !error && allProducts.length === 0">
    No hay productos disponibles.
  </div>

  <!-- Modal del producto -->
</div>
